Cleaned up code, began work on duplicate avoidance function
